<!DOCTYPE HTML>
<head>
	<meta charset="utf-8">
	<title>Moire Test</title>
	<link href="https://fonts.googleapis.com/css?family=Aleo:300&display=swap" rel="stylesheet">
	<style>body {font-family: 'Aleo', serif;} h1 {text-align: center;}h3 {text-align: center;} #circle{filter: brightness(0.5) sepia(1) hue-rotate(-70deg) saturate(5);;}</style>
</head>
<body>
	<h1>JS Coordinates Example (click square, read results in console)</h1>
	<h3>by Kevin Higgins</h3>
	<input type="button" value="Next element" id="next-button"></input>
	<section>
		<svg xmlns="http://www.w3.org/2000/svg" id="vector" viewBox="0 0 400 400" height="400" width="400" shape-rendering="crispEdges">
			<defs>
			</defs>
			
			
		</svg>
	</section>
	<script>
		var r = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
		r.setAttributeNS(null, 'x', 200);
		r.setAttributeNS(null, 'y', 200);
		r.setAttributeNS(null, 'width', 200);
		r.setAttributeNS(null, 'height', 200);
		r.setAttributeNS(null, 'fill', 'black');
		r.setAttributeNS(null, 'stroke', 'black');
		r.addEventListener('mouseup', showCoords);
		svg = document.getElementById('vector');
		svg.appendChild(r);
		function showCoords(e) {
			t = e.currentTarget;
			console.clear();
			console.log('getBoundingClientRect of rect', t.getBoundingClientRect().left, t.getBoundingClientRect().top);
			console.log('getBoundingClientRect of svg', svg.getBoundingClientRect().left, svg.getBoundingClientRect().top);
			console.log('client', e.clientX, e.clientY);
			console.log('page', e.pageX, e.pageY);
			console.log('offset', e.offsetX, e.offsetY);
			console.log('screen', e.screenX, e.screenY);
		}
		/*
		document.querySelector('#next-button').addEventListener("click", switchHandles);
		var svgObject = document.getElementById('vector');
		var handles = [];
		var selectedHandle = -1;
		var paths; // name is provisional - I mean named shapes, paths and lines - TO DO figure out whether shapes for masks are in here
		var selectedPath = 0; // for now we'll always have a path selected, so start on the one at the bottom of the array (this assumes there is one)
		var svgX = svgObject.getBoundingClientRect().left;
		var svgY = svgObject.getBoundingClientRect().top;
		console.log('Y' + svgY);
		var grabX;
		var grabY;
		function switchHandles() { // to select next element (cycle through array of elements), that is, show its handles

		}
		function manifestHandle(x, y) {
			console.log("make");
			size = 10;
			var newHandle = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
			newHandle.setAttributeNS(null, 'x', x - size / 2);
			newHandle.setAttributeNS(null, 'y', y - size / 2);
			newHandle.setAttributeNS(null, 'width', size);
			newHandle.setAttributeNS(null, 'height', size);
			newHandle.setAttributeNS(null, 'fill', 'red');
			newHandle.setAttributeNS(null, 'class', 'draggable');
			newHandle.setAttributeNS(null, 'id', 'handle' + i);
			newHandle.addEventListener("mousedown", startDragging);
			document.addEventListener("mousemove", drag);
			newHandle.addEventListener("mouseup", endDragging);
			svgObject.appendChild(newHandle);
		}
		// get document coordinates of the element
		function getCoords(elem) {
		  let box = elem.getBoundingClientRect();

		  return {
		    top: box.top + window.pageYOffset,
		    left: box.left + window.pageXOffset
		  };
		}
		function getID(handle) {
			return handle.getAttributeNS(null, 'id').charAt(6);
		}
		function startDragging(e) {
			thisHandle = e.currentTarget;
			selectedHandle = getID(thisHandle);
			console.log(getCoords(thisHandle).top, getCoords(thisHandle).left);
			handleXOffset = handles[selectedHandle][0] - e.pageX;
			handleYOffset = handles[selectedHandle][1] - e.pageY + svgY;
			console.log(handleXOffset, handleYOffset);
		}
		function drag(e) {
			if (selectedHandle >= 0) { //drawing the lines is making it hard to mouseup
				handle = document.querySelector('#handle' + selectedHandle);
				// move handle
				svgObject.removeChild(barLine);
				if (selectedHandle == 0) {
					//move x1, y1 of line

				}
				else if (selectedHandle == 1) {
					//move x2, y2 of line
				}
				barLine.setAttributeNS(null, 'stroke-width', 500);
				barLine.setAttributeNS(null, 'stroke', 'white');
				barLine.setAttributeNS(null, 'stroke-dasharray', '1,2,1,2,1,1,1,2');
				svgObject.appendChild(barLine);
			}
		}
		function endDragging(e) {
			selectedHandle = -1;

		}
		function resetHandles() {
			console.log("reset");
			handles = [];
			pair = [300, 300];
			handles[0] = pair;
			pair = [200, 300];
			handles[1] = pair;
			for (i = 0; i < handles.length; i++) {
				manifestHandle(handles[i][0], handles[i][1]);
			}
		}
		console.log(svgObject);
		var svgDefs = svgObject.children[0];
		console.log(svgDefs);
		var barLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
		barLine.setAttributeNS(null, 'x1', '300');
		barLine.setAttributeNS(null, 'y1', '300');
		barLine.setAttributeNS(null, 'x2', '305');

		barLine.setAttributeNS(null, 'y2', '350');
		barLine.setAttributeNS(null, 'stroke-width', 500);
		barLine.setAttributeNS(null, 'stroke', 'white');
		barLine.setAttributeNS(null, 'stroke-dasharray', '1,2,1,2,1,1,1,2');
		//paths[0] = barLine; // later we'll do setup better - just a provisional test path for now
		svgObject.appendChild(barLine);
		resetHandles(); // set them up
console.log('done');
	*/	
	</script>
		
</body>